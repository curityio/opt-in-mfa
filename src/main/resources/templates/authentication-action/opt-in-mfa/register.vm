#*
 *  Copyright 2021 Curity AB
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *###

#parse("fragments/icon-mappings")

#set($title = "Register another second factor")

#set ($page_symbol = $page_symbol_authenticate_desktop)

#define ($_body)
    <p>Select another second factor which you want to use to verify the login.</p>

    <form class="center" action="$_actionUrl/register" method="POST" id="secondFactorForm">
        <div class="form-field mb1">
            <p>Give your second factor a name, e.g. "Authenticator on my private moible", "company key 1", etc.</p>
            <input type="text" name="secondFactorName" id="secondFactorName" />
            <label for="secondFactorName">Name for the second factor</label>
        </div>
        #foreach($_authenticatorItem in $availableAuthenticators)
            <div class="form-field mb1">
                <button type="submit" id="$_authenticatorItem.acr" class="button-secondary-factor button button-primary button-fullwidth button-social button-$_authenticatorItem.type">
                    <i class="icon #iconClassName($_authenticatorItem.type)"></i>
                    $_authenticatorItem.description
                </button>
            </div>
        #end
        <input type="hidden" id="secondFactor" name="secondFactor" value="" />
    </form>

    <p>Here is a list of your current second factors. Click on a factor to delete it.</p>
    <form class="center" action="$_actionUrl/register" method="POST" id="secondFactorForm">

        #foreach($_authenticatorItem in $currentAuthenticators)
            <div class="form-field mb1">
                <button type="submit" id="$_authenticatorItem.acr" class="button-delete-secondary-factor button button-primary button-fullwidth button-social button-$_authenticatorItem.type">
                    <i class="icon #iconClassName($_authenticatorItem.type)"></i>
                    <span>$_authenticatorItem.description</span>
                </button>
            </div>
        #end
        <input type="hidden" id="deleteSecondFactor" name="secondFactorName" value="" />
        <input type="hidden" name="deleteFactor" value="true" />
    </form>

    #parse("fragments/jquery")

    <script type="text/javascript" $!nonceAttr>
        jQuery(document).ready(function ($) {
            $(".button-secondary-factor").on("click", function(e) {
                $("#secondFactor").val(this.id);
            });

            $(".button-delete-secondary-factor").on("click", function(e) {
                $("#deleteSecondFactor").val($(this).find("span").text());
            });
        });
    </script>
#end

#parse("layouts/default")
